<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Ferm - IPtables The Right Way &mdash; DevPad</title>
  <meta name="author" content="Manuel Gutierrez">

  <link href="http://xr09.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate"
        title="DevPad RSS Feed" />





  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="http://xr09.github.io/favicon.png" rel="icon">

  <link href="http://xr09.github.io/theme/css/main.css" media="screen, projection"
        rel="stylesheet" type="text/css">

  <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
</head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="http://xr09.github.io/">DevPad</a></h1>
    <h2>clean code, good karma</h2>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://xr09.github.io/feeds/all.rss.xml" rel="subscribe-rss">RSS</a></li>
</ul>


<ul class="main-navigation">
      <li><a href="http://xr09.github.io/pages/about.html">About</a></li>
      <li><a href="http://xr09.github.io/pages/projects.html">Projects</a></li>
      <li >
        <a href="http://xr09.github.io/category/server.html">Server</a>
      </li>
      <li >
        <a href="http://xr09.github.io/category/os.html">Os</a>
      </li>
      <li class="active">
        <a href="http://xr09.github.io/category/dev.html">Dev</a>
      </li>
</ul></nav>
  <div id="main">
    <div id="content">
<div>
  <article class="hentry" role="article">
<header>
      <h1 class="entry-title">Ferm - IPtables The Right Way</h1>
    <p class="meta">
<time datetime="2014-10-14T14:15:00" pubdate>Tue 14 October 2014</time>    </p>
</header>

  <div class="entry-content"><p>This is a small post but totally worth it. Just wanted to point out I've finally found the ultimate meta language for managing iptables: <a class="reference external" href="http://ferm.foo-projects.org/">ferm</a>.</p>
<p>To keep this brief let's say Ferm is to IPtables as C is to ASM. It gives you plenty of high level constructs to manage list of ports, ip addresses and so forth, heck you can even create functions with parameters and all.</p>
<p>Let's give it a try:</p>
<div class="highlight"><pre><span class="nv">$ </span>aptitude install ferm     <span class="c"># Debian/Ubuntu</span>
<span class="nv">$ </span>yum install ferm          <span class="c"># Fedora/CentOS</span>
</pre></div>
<p>Now you have two new commands in your path: <em>ferm</em> and <em>import-ferm</em></p>
<p>Reading the man page and command help is a good start.</p>
<p>Basically ferm reads the rule file and compiles to iptables, then it loads everything to the system with <em>iptables-restore</em>, I recommend using <em>ferm -nl rules.ferm</em> and keep tuning the file until you get what you need.</p>
<p>The <em>import-ferm</em> command reads you current iptables rules and prints the equivalent ferm rules to stdout. Of course it will be too explicit, you should define arrays and use all the cool features ferm provides.</p>
<div class="highlight"><pre>import-ferm &gt; /etc/ferm/rules.ferm <span class="c"># this could be a starting point</span>
</pre></div>
<p>On Debian the ferm package also provides a service (something like iptables-persistent), this makes possible to have the rules written only with ferm syntax, they will be parsed each time the ferm service is started.</p>
<p>Some simple rules to get you interested:</p>
<div class="highlight"><pre>@def <span class="nv">$TRUSTED</span> <span class="o">=</span> <span class="o">(</span>10.0.3.5 10.0.5.0/24 10.0.3.8<span class="o">)</span><span class="p">;</span>

table filter <span class="o">{</span>
chain INPUT <span class="o">{</span>
    policy DROP<span class="p">;</span>

    <span class="c"># connection tracking</span>
    mod state state <span class="o">(</span>ESTABLISHED RELATED<span class="o">)</span> ACCEPT<span class="p">;</span>

    <span class="c"># allow local connections</span>
    interface lo ACCEPT<span class="p">;</span>

    <span class="c"># respond to ping</span>
    proto icmp icmp-type <span class="nb">echo</span>-request ACCEPT<span class="p">;</span>

    <span class="c"># allow SSH connections to trusted addresses</span>
    saddr <span class="nv">$TRUSTED</span> <span class="o">{</span>
        proto tcp dport ssh ACCEPT<span class="p">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c"># outgoing connections are not limited</span>
chain OUTPUT policy ACCEPT<span class="p">;</span>

<span class="c"># this is not a router</span>
chain FORWARD policy DROP<span class="p">;</span>
<span class="o">}</span>
</pre></div>
</div>
    <footer>
<p class="meta">
  <span class="byline author vcard">
    Posted by <span class="fn">
        Manuel Gutierrez
    </span>
  </span>
<time datetime="2014-10-14T14:15:00" pubdate>Tue 14 October 2014</time>  <span class="categories">
    <a class='category' href='http://xr09.github.io/category/dev.html'>dev</a>
  </span>
  <span class="categories">
    <a class="category" href="http://xr09.github.io/tag/.html"></a>  </span>
</p><div class="sharing">
</div>    </footer>
  </article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
  </section>
</div>
<aside class="sidebar">
  <section>
	  <img src="http://xr09.github.io/images/xr09.jpg" alt="" width=""/> 
  </section>
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="http://xr09.github.io/ferm-iptables-the-right-way.html">Ferm - IPtables The Right Way</a>
      </li>
      <li class="post">
          <a href="http://xr09.github.io/debian-repo-minimal-edition.html">Debian Repo - Minimal Edition</a>
      </li>
      <li class="post">
          <a href="http://xr09.github.io/running-the-latest-debmirror-on-centos-5.html">Running The Latest Debmirror On CentOS 5</a>
      </li>
      <li class="post">
          <a href="http://xr09.github.io/stripping-down-centos.html">Stripping Down Centos</a>
      </li>
      <li class="post">
          <a href="http://xr09.github.io/cron-scheduling-for-the-fancy.html">Cron Scheduling For The Fancy</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="http://xr09.github.io/category/server.html">server</a></li>
        <li><a href="http://xr09.github.io/category/os.html">os</a></li>
        <li><a href="http://xr09.github.io/category/dev.html">dev</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
    <a href="http://xr09.github.io/tag/.html"></a>,    <a href="http://xr09.github.io/tag/debmirror.html">debmirror</a>,    <a href="http://xr09.github.io/tag/git.html">git</a>,    <a href="http://xr09.github.io/tag/tuning.html">tuning</a>,    <a href="http://xr09.github.io/tag/centos.html">centos</a>,    <a href="http://xr09.github.io/tag/pelican.html">pelican</a>,    <a href="http://xr09.github.io/tag/admin.html">admin</a>,    <a href="http://xr09.github.io/tag/ubuntu.html">ubuntu</a>,    <a href="http://xr09.github.io/tag/job.html">job</a>,    <a href="http://xr09.github.io/tag/rolodex.html">rolodex</a>,    <a href="http://xr09.github.io/tag/perl.html">perl</a>,    <a href="http://xr09.github.io/tag/cron.html">cron</a>,    <a href="http://xr09.github.io/tag/nginx.html">nginx</a>,    <a href="http://xr09.github.io/tag/unix.html">unix</a>,    <a href="http://xr09.github.io/tag/sed.html">sed</a>,    <a href="http://xr09.github.io/tag/static.html">static</a>,    <a href="http://xr09.github.io/tag/blog.html">blog</a>,    <a href="http://xr09.github.io/tag/performance.html">performance</a>,    <a href="http://xr09.github.io/tag/repo.html">repo</a>,    <a href="http://xr09.github.io/tag/debian.html">debian</a>,    <a href="http://xr09.github.io/tag/bash.html">bash</a>  </section>



<section>
    <p>Follow <a href="http://twitter.com/xr09">@xr09</a></p>
</section>
</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
      Copyright &copy; 2015 - Manuel E. Gutierrez - 
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
  <script src="http://xr09.github.io/theme/js/modernizr-2.0.js"></script>
  <script src="http://xr09.github.io/theme/js/ender.js"></script>
  <script src="http://xr09.github.io/theme/js/octopress.js" type="text/javascript"></script>
  <script type="text/javascript">
    var disqus_shortname = 'devpad';
    var disqus_identifier = '/ferm-iptables-the-right-way.html';
    var disqus_url = 'http://xr09.github.io/ferm-iptables-the-right-way.html';
    var disqus_title = 'Ferm - IPtables The Right Way';
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = "//" + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
  </script>
</body>
</html>