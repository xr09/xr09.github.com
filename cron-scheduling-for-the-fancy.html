<!DOCTYPE html>
<html lang="en">
  <head>
    <link href='http://fonts.googleapis.com/css?family=Noticia+Text:400,700' rel='stylesheet' type='text/css' />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title> Cron Scheduling For The Fancy | DevPad </title>

    <link rel="stylesheet" href="http://xr09.github.io/theme/css/style.css" type="text/css" />
    <link rel="stylesheet" href="http://xr09.github.io/theme/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://xr09.github.io/theme/css/font-awesome.css" type="text/css"/>
  </head>
  <body>
    <div class=container>
<div class="header">
    <a href="http://xr09.github.io/">DevPad</a> <span class="muted">clean code, good karma</span>
</div>

<div class=navigation>
    <ul>
            <li><a href="http://xr09.github.io/pages/projects.html">Projects</a> </li>
            <li><a href="http://xr09.github.io/archives.html">Archive</a> </li>
            <li><a href="http://xr09.github.io/tags.html">Tags</a> </li>
            <li><a href="http://xr09.github.io/pages/about.html">About</a> </li>
    </ul>
</div>
<div class=separator></div>        
        <div class=body>
    <h1 class="title"> Cron Scheduling For The Fancy</h1>
    <p class=date> Tue 01 April 2014 </p>
    <p>Cron is a powerful tool for a sysadmin, the fact that you are able to run tasks at any time, any day, is amazing.</p>
<p>The regular cron is ok for like 99% of the needs, there's no need for anything else unless you want to go fancy.</p>
<p>So let's get fancy.</p>
<p>Have you ever wanted to run a task the first monday of the month? Or maybe the second friday? Third Thursday?... Last Sunday? You get it.</p>
<p>That's fancy requirements, the regular implementation of cron on most distros can't do it, but there's an easy fix.</p>
<p>By taking advantage of the fact that what cron actually executes is a bash command we can hack its behavior a little. You can check for the desired date with bash and execute the desired command according to the obtained result.</p>
<p>Check this for running a task only the first saturday of the month.</p>
<div class="highlight"><pre><span class="m">30</span> <span class="m">6</span> 1-7 * * root <span class="o">[</span> <span class="s2">&quot;</span><span class="k">$(</span>date <span class="s1">&#39;+\%a&#39;</span><span class="k">)</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;Sat&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> /root/myfirstsaturdaybackup.sh
</pre></div>
<p>The cron will run from day 1 to 7, but the script is executed only when the <em>[date]</em> check is true i.e. the only saturday between day 1 and 7.</p>
<p>This looks like a good ad-hoc solution but I wanted something less error prone and easier to use.</p>
<p>So I created <a class="reference external" href="https://github.com/xr09/cron-last-sunday">cron-last-sunday</a> just for that.</p>
<p>To install it, just copy the script <em>run-if-today</em> to /usr/bin/ or anywhere on the path</p>
<p>You can use it like this:</p>
<div class="highlight"><pre><span class="m">30</span> <span class="m">6</span> * * <span class="m">6</span> root run-if-today <span class="m">1</span> Sat <span class="o">&amp;&amp;</span> /root/myfirstsaturdaybackup.sh
</pre></div>
<p>This task will run every saturday (see the 6 before <em>root</em>), but the script will trigger only on the first one, you could even run the task every day &quot;* * *&quot; and the script would only run on the first saturday.</p>
<p>Check out a task for last sunday of the month:</p>
<div class="highlight"><pre><span class="m">30</span> <span class="m">6</span> * * <span class="m">7</span> root run-if-today L Sun <span class="o">&amp;&amp;</span> touch /opt/last-sunday
</pre></div>
<p>Use <strong>L</strong> or <strong>l</strong> for last, granted to work on february and leap years. ;)</p>
<p>Please read the <a class="reference external" href="https://github.com/xr09/cron-last-sunday/blob/master/run-if-today">code</a> if you want to see how it works, it's pretty short and simple. I even put a bad joke or two.</p>

    
    <p class=tags>This entry was tagged as
      <a href="http://xr09.github.io/tag/unix.html">unix</a>
      <a href="http://xr09.github.io/tag/cron.html">cron</a>
      <a href="http://xr09.github.io/tag/admin.html">admin</a>
    </p>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'devpad'; // required: replace example with your forum shortname
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
        
<div class=footer>
  <p>&copy; Copyright <script language="JavaScript">var date = new Date(); document.write(date.getFullYear());</script> by Manuel Gutierrez</p>
  <p> Powered by <a href="http://pypi.python.org/pypi/pelican/" target="_blank">Pelican</a>.  
  </p> 
  <p>
    <div class=social style="font-size: 27px;">
      <ul>
        <script language="JavaScript">
          u = 'mgp';
          s = 'nauta.cu';
          document.write('<a href=\"mailto:' + u + '@' + s + '\" target=\"_blank\">');
        </script>
            <li><i class="icon-envelope icon-large"></i> </li>
        </a>
        <a href="https://twitter.com/" target="_blank"> <li> <i class="icon-twitter-sign icon-large"> </li></i> </a>
        <a href="https://www.linkedin.com/pub/manuel-enrique-gutierrez-perez/43/a31/a9"><li><i class="icon-linkedin-sign icon-large" ></i></li></a>
        <a href="https://github.com/xr09" target="_blank"> <li> <i class="icon-github-sign icon-large"></i> </li> </a>
        <a href="http://xr09.github.io/feeds/all.rss.xml" rel="alternate" title="Recent Blog Posts"><li> <i class="icon-rss icon-large"></i> </li></a>
      </ul>
    </div>
  </p>
</div>    </div>
  </body>
</html>
