<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Running The Latest Debmirror On CentOS 5 &mdash; DevPad</title>
  <meta name="author" content="Manuel Gutierrez">

  <link href="http://xr09.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate"
        title="DevPad RSS Feed" />





  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="http://xr09.github.io/favicon.png" rel="icon">

  <link href="http://xr09.github.io/theme/css/main.css" media="screen, projection"
        rel="stylesheet" type="text/css">

  <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
</head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="http://xr09.github.io/">DevPad</a></h1>
    <h2>clean code, good karma</h2>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://xr09.github.io/feeds/all.rss.xml" rel="subscribe-rss">RSS</a></li>
</ul>


<ul class="main-navigation">
      <li><a href="http://xr09.github.io/pages/about.html">About</a></li>
      <li><a href="http://xr09.github.io/pages/projects.html">Projects</a></li>
      <li >
        <a href="http://xr09.github.io/category/server.html">Server</a>
      </li>
      <li class="active">
        <a href="http://xr09.github.io/category/os.html">Os</a>
      </li>
      <li >
        <a href="http://xr09.github.io/category/dev.html">Dev</a>
      </li>
</ul></nav>
  <div id="main">
    <div id="content">
<div>
  <article class="hentry" role="article">
<header>
      <h1 class="entry-title">Running The Latest Debmirror On CentOS 5</h1>
    <p class="meta">
<time datetime="2014-04-30T14:59:00-04:00" pubdate>Wed 30 April 2014</time>    </p>
</header>

  <div class="entry-content"><div class="section" id="to-sync-a-deb-repo">
<h2>To sync a deb repo</h2>
<p>So, today at work we had to download the brand new Ubuntu 14.04, there are two options to do it: apt-mirror and debmirror.</p>
<p>The advantage of apt-mirror is the ability to download a repo with multiple threads, if bandwith is not an issue then your downloads will fly, on the bad side you can't filter unwanted sections of a repo, it's all or nothing.</p>
<p>Debmirror on the other side gives you the ability to filter by repo sections or even regular expressions, over the years I've tuned my filters and now Debian Wheezy fits on just ~12 GB, avoiding nearly 40 Gb of unused packages.</p>
<p>On the bad side debmirror doesn't supports threads, but let's face it, the ability of pruning a repo is priceless, not only because of space but also bandwith, if your company maintains a local Debian/Ubuntu repo then having around 10 GB of games and 5 more on debug packages is pointless.</p>
</div>
<div class="section" id="pruning-method">
<h2>Pruning method</h2>
<p>Our pruning technique will be shared in a future post, but just to have an idea is nothing more than using the <em>--exclude</em> and <em>--exclude-deb-section</em> options from debmirror:</p>
<div class="highlight"><pre>--exclude-deb-section<span class="o">=</span><span class="s1">&#39;(games|debug|news|electronics)&#39;</span>
--exclude<span class="o">=</span><span class="s1">&#39;/myspell-pt.*&#39;</span> <span class="se">\</span>
--exclude<span class="o">=</span><span class="s1">&#39;(/libhdf5-doc.*)&#39;</span> <span class="se">\</span>
</pre></div>
</div>
<div class="section" id="current-status">
<h2>Current status</h2>
<p>This procedure is fairly easy on a recent distro, but let's assume we have CentOS 5.9 with Perl 5.8 and debmirror <em>20090807</em> and we want the latest debmirror which needs a recent Perl interpreter.</p>
</div>
<div class="section" id="attack-plan">
<h2>Attack plan</h2>
<p>Is not a good idea to start messing with the default Perl installation, the safest choice is installing a new version somewhere like <em>/opt/</em> and using it from there.</p>
<p><a class="reference external" href="http://www.activestate.com/activeperl/downloads">ActivePerl</a> is a perfect choice for this case, just download and install on <em>/opt/ActivePerl/</em>.</p>
<p>Now check the interpreter:</p>
<div class="highlight"><pre>/opt/ActivePerl/bin/perl -v
This is perl 5, version 16, subversion 3 <span class="o">(</span>v5.16.3<span class="o">)</span> built <span class="k">for </span>i686-linux-thread-multi
...
</pre></div>
<p>Perfect, now just drop in a recent <a class="reference external" href="http://ftp.de.debian.org/debian/pool/main/d/debmirror/debmirror_2.16.tar.gz">debmirror</a> script and change the <a class="reference external" href="http://en.wikipedia.org/wiki/Shebang_%28Unix%29">shebang</a> to point to the new Perl.</p>
<p>Like this:</p>
<div class="highlight"><pre><span class="c">#!/opt/ActivePerl-5.16/bin/perl -w</span>

<span class="o">=</span>head1 NAME
</pre></div>
</div>
<div class="section" id="perl-modules">
<h2>Perl Modules</h2>
<p>If you try to use this you'll get an error, debmirror needs a module not included in ActivePerl by default &quot;LockFile::Simple&quot;, easy fix, just have to <a class="reference external" href="http://www.activestate.com/blog/2010/10/how-install-cpan-modules-activeperl">install</a> it from CPAN.</p>
<div class="highlight"><pre>/opt/ActivePerl/bin/cpan LockFile::Simple
</pre></div>
<p>Remember to export http_proxy in case you need it.</p>
</div>
<div class="section" id="sync-baby-sync">
<h2>Sync Baby, Sync!</h2>
<p>The rest is easy cake, now you have a recent debmirror with a brand new Perl interpreter running on top of the old crusty CentOS 5. Rejoice.</p>
</div>
</div>
    <footer>
<p class="meta">
  <span class="byline author vcard">
    Posted by <span class="fn">
        Manuel Gutierrez
    </span>
  </span>
<time datetime="2014-04-30T14:59:00-04:00" pubdate>Wed 30 April 2014</time>  <span class="categories">
    <a class='category' href='http://xr09.github.io/category/os.html'>os</a>
  </span>
  <span class="categories">
    <a class="category" href="http://xr09.github.io/tag/centos.html">centos</a>,    <a class="category" href="http://xr09.github.io/tag/perl.html">perl</a>,    <a class="category" href="http://xr09.github.io/tag/debmirror.html">debmirror</a>,    <a class="category" href="http://xr09.github.io/tag/debian.html">debian</a>,    <a class="category" href="http://xr09.github.io/tag/ubuntu.html">ubuntu</a>  </span>
</p><div class="sharing">
</div>    </footer>
  </article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
  </section>
</div>
<aside class="sidebar">
  <section>
	  <img src="http://xr09.github.io/images/xr09.jpg" alt="" width=""/> 
  </section>
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="http://xr09.github.io/ferm-iptables-the-right-way.html">Ferm - IPtables The Right Way</a>
      </li>
      <li class="post">
          <a href="http://xr09.github.io/debian-repo-minimal-edition.html">Debian Repo - Minimal Edition</a>
      </li>
      <li class="post">
          <a href="http://xr09.github.io/running-the-latest-debmirror-on-centos-5.html">Running The Latest Debmirror On CentOS 5</a>
      </li>
      <li class="post">
          <a href="http://xr09.github.io/stripping-down-centos.html">Stripping Down Centos</a>
      </li>
      <li class="post">
          <a href="http://xr09.github.io/cron-scheduling-for-the-fancy.html">Cron Scheduling For The Fancy</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="http://xr09.github.io/category/server.html">server</a></li>
        <li><a href="http://xr09.github.io/category/os.html">os</a></li>
        <li><a href="http://xr09.github.io/category/dev.html">dev</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
    <a href="http://xr09.github.io/tag/.html"></a>,    <a href="http://xr09.github.io/tag/debmirror.html">debmirror</a>,    <a href="http://xr09.github.io/tag/git.html">git</a>,    <a href="http://xr09.github.io/tag/tuning.html">tuning</a>,    <a href="http://xr09.github.io/tag/centos.html">centos</a>,    <a href="http://xr09.github.io/tag/pelican.html">pelican</a>,    <a href="http://xr09.github.io/tag/admin.html">admin</a>,    <a href="http://xr09.github.io/tag/ubuntu.html">ubuntu</a>,    <a href="http://xr09.github.io/tag/job.html">job</a>,    <a href="http://xr09.github.io/tag/rolodex.html">rolodex</a>,    <a href="http://xr09.github.io/tag/perl.html">perl</a>,    <a href="http://xr09.github.io/tag/cron.html">cron</a>,    <a href="http://xr09.github.io/tag/nginx.html">nginx</a>,    <a href="http://xr09.github.io/tag/unix.html">unix</a>,    <a href="http://xr09.github.io/tag/sed.html">sed</a>,    <a href="http://xr09.github.io/tag/static.html">static</a>,    <a href="http://xr09.github.io/tag/blog.html">blog</a>,    <a href="http://xr09.github.io/tag/performance.html">performance</a>,    <a href="http://xr09.github.io/tag/repo.html">repo</a>,    <a href="http://xr09.github.io/tag/debian.html">debian</a>,    <a href="http://xr09.github.io/tag/bash.html">bash</a>  </section>



<section>
    <p>Follow <a href="http://twitter.com/xr09">@xr09</a></p>
</section>
</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
      Copyright &copy; 2015 - Manuel E. Gutierrez - 
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
  <script src="http://xr09.github.io/theme/js/modernizr-2.0.js"></script>
  <script src="http://xr09.github.io/theme/js/ender.js"></script>
  <script src="http://xr09.github.io/theme/js/octopress.js" type="text/javascript"></script>
  <script type="text/javascript">
    var disqus_shortname = 'devpad';
    var disqus_identifier = '/running-the-latest-debmirror-on-centos-5.html';
    var disqus_url = 'http://xr09.github.io/running-the-latest-debmirror-on-centos-5.html';
    var disqus_title = 'Running The Latest Debmirror On CentOS 5';
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = "//" + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
  </script>
</body>
</html>