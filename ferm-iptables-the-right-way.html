<!DOCTYPE html>
<html lang="en">
  <head>
    <link href='http://fonts.googleapis.com/css?family=Noticia+Text:400,700' rel='stylesheet' type='text/css' />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title> Ferm - IPtables The Right Way | DevPad </title>

    <link rel="stylesheet" href="http://xr09.github.io/theme/css/style.css" type="text/css" />
    <link rel="stylesheet" href="http://xr09.github.io/theme/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://xr09.github.io/theme/css/font-awesome.css" type="text/css"/>
  </head>
  <body>
    <div class=container>
<div class="header">
    <a href="http://xr09.github.io/">DevPad</a> <span class="muted">clean code, good karma</span>
</div>

<div class=navigation>
    <ul>
            <li><a href="http://xr09.github.io/pages/projects.html">Projects</a> </li>
            <li><a href="http://xr09.github.io/archives.html">Archive</a> </li>
            <li><a href="http://xr09.github.io/pages/about.html">About</a> </li>
    </ul>
</div>
<div class=separator></div>        
        <div class=body>
    <h1 class="title"> Ferm - IPtables The Right Way</h1>
    <p class=date> Tue 14 October 2014 </p>
    <p>This is a small post but totally worth it. Just wanted to point out I've finally found the ultimate meta language for managing iptables: <a class="reference external" href="http://ferm.foo-projects.org/">ferm</a>.</p>
<p>To keep this brief let's say Ferm is to IPtables as C is to ASM. It gives you plenty of high level constructs to manage list of ports, ip addresses and so forth, heck you can even create functions with parameters and all.</p>
<p>Let's give it a try:</p>
<div class="highlight"><pre><span class="nv">$ </span>aptitude install ferm     <span class="c"># Debian/Ubuntu</span>
<span class="nv">$ </span>yum install ferm          <span class="c"># Fedora/CentOS</span>
</pre></div>
<p>Now you have two new commands in your path: <em>ferm</em> and <em>import-ferm</em></p>
<p>Reading the man page and command help is a good start.</p>
<p>Basically ferm reads the rule file and compiles to iptables, then it loads everything to the system with <em>iptables-restore</em>, I recommend using <em>ferm -nl rules.ferm</em> and keep tuning the file until you get what you need.</p>
<p>The <em>import-ferm</em> command reads you current iptables rules and prints the equivalent ferm rules to stdout. Of course it will be too explicit, you should define arrays and use all the cool features ferm provides.</p>
<div class="highlight"><pre>import-ferm &gt; /etc/ferm/rules.ferm <span class="c"># this could be a starting point</span>
</pre></div>
<p>On Debian the ferm package also provides a service (something like iptables-persistent), this makes possible to have the rules written only with ferm syntax, they will be parsed each time the ferm service is started.</p>
<p>Some simple rules to get you interested:</p>
<div class="highlight"><pre>@def <span class="nv">$TRUSTED</span> <span class="o">=</span> <span class="o">(</span>10.0.3.5 10.0.5.0/24 10.0.3.8<span class="o">)</span><span class="p">;</span>

table filter <span class="o">{</span>
chain INPUT <span class="o">{</span>
    policy DROP<span class="p">;</span>

    <span class="c"># connection tracking</span>
    mod state state <span class="o">(</span>ESTABLISHED RELATED<span class="o">)</span> ACCEPT<span class="p">;</span>

    <span class="c"># allow local connections</span>
    interface lo ACCEPT<span class="p">;</span>

    <span class="c"># respond to ping</span>
    proto icmp icmp-type <span class="nb">echo</span>-request ACCEPT<span class="p">;</span>

    <span class="c"># allow SSH connections to trusted addresses</span>
    saddr <span class="nv">$TRUSTED</span> <span class="o">{</span>
        proto tcp dport ssh ACCEPT<span class="p">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c"># outgoing connections are not limited</span>
chain OUTPUT policy ACCEPT<span class="p">;</span>

<span class="c"># this is not a router</span>
chain FORWARD policy DROP<span class="p">;</span>
<span class="o">}</span>
</pre></div>

    
<div class=twitter>
<a href="https://twitter.com/share" class="twitter-share-button">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</div>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'devpad'; // required: replace example with your forum shortname
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
        
<div class=footer>
  <p>&copy; Copyright <script language="JavaScript">var date = new Date(); document.write(date.getFullYear());</script> by Manuel Gutierrez</p>
  <p> Powered by <a href="http://pypi.python.org/pypi/pelican/" target="_blank">Pelican</a>.  
  </p> 
  <p>
    <div class=social style="font-size: 27px;">
      <ul>
        <script language="JavaScript">
          u = 'mgp';
          s = 'nauta.cu';
          document.write('<a href=\"mailto:' + u + '@' + s + '\" target=\"_blank\">');
        </script>
            <li><i class="icon-envelope icon-large"></i> </li>
        </a>
        <a href="https://twitter.com/xr09" target="_blank"> <li> <i class="icon-twitter-sign icon-large"> </li></i> </a>
        <a href="https://github.com/xr09" target="_blank"> <li> <i class="icon-github-sign icon-large"></i> </li> </a>
        <a href="http://xr09.github.io/feeds/all.rss.xml" rel="alternate" title="Recent Blog Posts"><li> <i class="icon-rss icon-large"></i> </li></a>
      </ul>
    </div>
  </p>
</div>    </div>
  </body>
</html>
