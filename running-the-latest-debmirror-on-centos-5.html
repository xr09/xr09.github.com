<!DOCTYPE html>
<html lang="en">
  <head>
    <link href='http://fonts.googleapis.com/css?family=Noticia+Text:400,700' rel='stylesheet' type='text/css' />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title> Running The Latest Debmirror On CentOS 5 | DevPad </title>

    <link rel="stylesheet" href="http://xr09.github.io/theme/css/style.css" type="text/css" />
    <link rel="stylesheet" href="http://xr09.github.io/theme/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://xr09.github.io/theme/css/font-awesome.css" type="text/css"/>
  </head>
  <body>
    <div class=container>
<div class="header">
    <a href="http://xr09.github.io/">DevPad</a> <span class="muted">clean code, good karma</span>
</div>

<div class=navigation>
    <ul>
            <li><a href="http://xr09.github.io/pages/projects.html">Projects</a> </li>
            <li><a href="http://xr09.github.io/archives.html">Archive</a> </li>
            <li><a href="http://xr09.github.io/pages/about.html">About</a> </li>
    </ul>
</div>
<div class=separator></div>        
        <div class=body>
    <h1 class="title"> Running The Latest Debmirror On CentOS 5</h1>
    <p class=date> Wed 30 April 2014 </p>
    <div class="section" id="to-sync-a-deb-repo">
<h2>To sync a deb repo</h2>
<p>So, today at work we had to download the brand new Ubuntu 14.04, there are two options to do it: apt-mirror and debmirror.</p>
<p>The advantage of apt-mirror is the ability to download a repo with multiple threads, if bandwith is not an issue then your downloads will fly, on the bad side you can't filter unwanted sections of a repo, it's all or nothing.</p>
<p>Debmirror on the other side gives you the ability to filter by repo sections or even regular expressions, over the years I've tuned my filters and now Debian Wheezy fits on just ~12 GB, avoiding nearly 40 Gb of unused packages.</p>
<p>On the bad side debmirror doesn't supports threads, but let's face it, the ability of pruning a repo is priceless, not only because of space but also bandwith, if your company maintains a local Debian/Ubuntu repo then having around 10 GB of games and 5 more on debug packages is pointless.</p>
</div>
<div class="section" id="pruning-method">
<h2>Pruning method</h2>
<p>Our pruning technique will be shared in a future post, but just to have an idea is nothing more than using the <em>--exclude</em> and <em>--exclude-deb-section</em> options from debmirror:</p>
<div class="highlight"><pre>--exclude-deb-section<span class="o">=</span><span class="s1">&#39;(games|debug|news|electronics)&#39;</span>
--exclude<span class="o">=</span><span class="s1">&#39;/myspell-pt.*&#39;</span> <span class="se">\</span>
--exclude<span class="o">=</span><span class="s1">&#39;(/libhdf5-doc.*)&#39;</span> <span class="se">\</span>
</pre></div>
</div>
<div class="section" id="current-status">
<h2>Current status</h2>
<p>This procedure is fairly easy on a recent distro, but let's assume we have CentOS 5.9 with Perl 5.8 and debmirror <em>20090807</em> and we want the latest debmirror which needs a recent Perl interpreter.</p>
</div>
<div class="section" id="attack-plan">
<h2>Attack plan</h2>
<p>Is not a good idea to start messing with the default Perl installation, the safest choice is installing a new version somewhere like <em>/opt/</em> and using it from there.</p>
<p><a class="reference external" href="http://www.activestate.com/activeperl/downloads">ActivePerl</a> is a perfect choice for this case, just download and install on <em>/opt/ActivePerl/</em>.</p>
<p>Now check the interpreter:</p>
<div class="highlight"><pre>/opt/ActivePerl/bin/perl -v
This is perl 5, version 16, subversion <span class="m">3</span> <span class="o">(</span>v5.16.3<span class="o">)</span> built <span class="k">for</span> i686-linux-thread-multi
...
</pre></div>
<p>Perfect, now just drop in a recent <a class="reference external" href="http://ftp.de.debian.org/debian/pool/main/d/debmirror/debmirror_2.16.tar.gz">debmirror</a> script and change the <a class="reference external" href="http://en.wikipedia.org/wiki/Shebang_%28Unix%29">shebang</a> to point to the new Perl.</p>
<p>Like this:</p>
<div class="highlight"><pre><span class="c">#!/opt/ActivePerl-5.16/bin/perl -w</span>

<span class="o">=</span>head1 NAME
</pre></div>
</div>
<div class="section" id="perl-modules">
<h2>Perl Modules</h2>
<p>If you try to use this you'll get an error, debmirror needs a module not included in ActivePerl by default &quot;LockFile::Simple&quot;, easy fix, just have to <a class="reference external" href="http://www.activestate.com/blog/2010/10/how-install-cpan-modules-activeperl">install</a> it from CPAN.</p>
<div class="highlight"><pre>/opt/ActivePerl/bin/cpan LockFile::Simple
</pre></div>
<p>Remember to export http_proxy in case you need it.</p>
</div>
<div class="section" id="sync-baby-sync">
<h2>Sync Baby, Sync!</h2>
<p>The rest is easy cake, now you have a recent debmirror with a brand new Perl interpreter running on top of the old crusty CentOS 5. Rejoice.</p>
</div>

    
<div class=twitter>
<a href="https://twitter.com/share" class="twitter-share-button">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</div>
    <p class=tags>This entry was tagged as
      <a href="http://xr09.github.io/tag/centos.html">centos</a>
      <a href="http://xr09.github.io/tag/perl.html">perl</a>
      <a href="http://xr09.github.io/tag/debmirror.html">debmirror</a>
      <a href="http://xr09.github.io/tag/debian.html">debian</a>
      <a href="http://xr09.github.io/tag/ubuntu.html">ubuntu</a>
    </p>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'devpad'; // required: replace example with your forum shortname
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
        
<div class=footer>
  <p>&copy; Copyright <script language="JavaScript">var date = new Date(); document.write(date.getFullYear());</script> by Manuel Gutierrez</p>
  <p> Powered by <a href="http://pypi.python.org/pypi/pelican/" target="_blank">Pelican</a>.  
  </p> 
  <p>
    <div class=social style="font-size: 27px;">
      <ul>
        <script language="JavaScript">
          u = 'mgp';
          s = 'nauta.cu';
          document.write('<a href=\"mailto:' + u + '@' + s + '\" target=\"_blank\">');
        </script>
            <li><i class="icon-envelope icon-large"></i> </li>
        </a>
        <a href="https://twitter.com/xr09" target="_blank"> <li> <i class="icon-twitter-sign icon-large"> </li></i> </a>
        <a href="https://github.com/xr09" target="_blank"> <li> <i class="icon-github-sign icon-large"></i> </li> </a>
        <a href="http://xr09.github.io/feeds/all.rss.xml" rel="alternate" title="Recent Blog Posts"><li> <i class="icon-rss icon-large"></i> </li></a>
      </ul>
    </div>
  </p>
</div>    </div>
  </body>
</html>
